import escapeString from 'escape-string-regexp'
export default class InterpolateHtmlPlugin {
  constructor(htmlWebpackPlugin, replacements) {
    this.name = 'interpolate-html-plugin'
    this.htmlWebpackPlugin = htmlWebpackPlugin
    this.replacements = replacements
  }
  apply(compiler) {
    compiler.hooks.compilation.tap(
      'InterpolateHtmlPlugin',
      compilation => {
        this.htmlWebpackPlugin
          .getHooks(compilation)
          .afterTemplateExecution.tap(
            'InterpolateHtmlPlugin',
            data => {
              Object.entries(this.replacements).forEach(
                ([key, value]) => {
                  data.html = data.html.replace(
                    new RegExp(`%${escapeString(key)}%`, 'g'),
                    value,
                  )
                },
              )
            },
          )
      },
    )
  }
}
//# sourceMappingURL=InterpolateHtmlPlugin.js.map
